<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messages – Roll ’n Connect</title>

  <style>
    body { margin:0; padding:0; font-family:system-ui; background:#05050a; color:white; }
    .hamburger { position:fixed; top:20px; left:20px; width:40px; height:32px; cursor:pointer; z-index:1000; display:flex; flex-direction:column; justify-content:space-between; }
    .hamburger div { height:6px; background:#4a4aff; border-radius:4px; box-shadow:0 0 12px #4a4aff; }
    .side-menu { position:fixed; top:0; left:-260px; width:260px; height:100vh; background:#0d0d16; padding:40px 20px; box-shadow:0 0 20px #4a4aff; transition:0.35s; z-index:999; }
    .side-menu.open { left:0; }
    .side-menu a { display:block; padding:14px; margin-bottom:14px; background:#14141c; border-radius:10px; text-decoration:none; color:white; font-size:18px; box-shadow:0 0 10px #4a4aff; }
    .page-container { max-width:900px; margin:0 auto; padding:80px 20px; }
    h1 { text-shadow:0 0 12px #4a4aff; margin-bottom:10px; }
    .thread-list { margin-top:20px; }
    .thread-card { background:#0f0f18; border-radius:14px; padding:14px; margin-bottom:12px; cursor:pointer; box-shadow:0 0 14px rgba(74,74,255,0.25); }
    .thread-title { font-weight:600; margin-bottom:4px; }
    .thread-meta { font-size:13px; opacity:0.7; }
    .empty-state { opacity:0.6; margin-top:20px; }
  </style>

  <script>
    function toggleMenu(){ document.querySelector('.side-menu').classList.toggle('open'); }

    function rcGet(key, fallback){ return JSON.parse(localStorage.getItem(key) || fallback); }

    document.addEventListener("DOMContentLoaded", () => {
      const profile = rcGet("rc_profile", "{}");
      const username = profile.username || "Unknown";

      const msgs = rcGet("rc_market_messages", "[]");
      const threads = buildThreads(msgs, username);

      const list = document.getElementById("threadList");
      list.innerHTML = threads.length
        ? threads.map(threadHTML).join("")
        : `<div class="empty-state">No messages yet.</div>`;
    });

    function buildThreads(messages, username){
      const map = {};
      messages.forEach(m => {
        if (m.from !== username && m.to !== username) return;
        const other = m.from === username ? m.to : m.from;
        const key = `${other}|${m.itemId}`;
        if (!map[key]) map[key] = { other, itemId: m.itemId, last: m };
        else if (m.timestamp > map[key].last.timestamp) map[key].last = m;
      });
      return Object.values(map);
    }

    function threadHTML(t){
      return `
        <div class="thread-card"
          onclick="location.href='marketplace-conversation.html?user=${encodeURIComponent(t.other)}&itemId=${t.itemId}'">
          <div class="thread-title">${t.last.itemTitle || "Item #" + t.itemId}</div>
          <div class="thread-meta">With ${t.other} • ${t.last.text}</div>
        </div>
      `;
    }
  </script>
</head>

<body>
  <div class="hamburger" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>

  <div class="side-menu">
    <a href="dashboard.html">Dashboard</a>
    <a href="marketplace.html">Marketplace</a>
    <a href="sell-item.html">Sell Item</a>
    <a href="your-listings.html">Your Listings</a>
    <a href="giveaways.html">Giveaways</a>
    <a href="marketplace-messages.html">Messages</a>
    <a href="marketplace-offers.html">Offers</a>
    <a href="marketplace-favorites.html">Favorites</a>
    <a href="marketplace-notifications.html">Notifications</a>
    <a href="profile.html">Profile</a>
    <a href="settings.html">Settings</a>
  </div>

  <div class="page-container">
    <h1>Messages</h1>
    <div id="threadList" class="thread-list"></div>
  </div>
</body>
</html>
