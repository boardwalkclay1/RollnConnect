<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Calendar ‚Äì Roll ‚Äôn Connect</title>

<style>
/* GLOBAL */
body {
  margin:0;
  padding:0;
  background:#000;
  color:#fff;
  font-family:'Inter',sans-serif;
  overflow-x:hidden;
  min-height:100vh;
}

/* STARS */
.stars {
  position:fixed;
  inset:0;
  background:url('styles/stars-white.png') repeat;
  opacity:0.45;
  z-index:-3;
  pointer-events:none;
  animation:starDrift 200s linear infinite;
}
@keyframes starDrift {
  from { background-position:0 0; }
  to { background-position:-4000px -2000px; }
}

/* BURGER */
.hamburger {
  position:fixed;
  top:22px;
  left:22px;
  width:40px;
  height:30px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
  z-index:9999;
}
.hamburger span {
  height:4px;
  width:100%;
  background:#fff;
  border-radius:4px;
  box-shadow:0 0 12px rgba(255,255,255,0.9);
  transition:0.3s;
}
.hamburger.active span:nth-child(1){transform:translateY(13px) rotate(45deg);}
.hamburger.active span:nth-child(2){opacity:0;}
.hamburger.active span:nth-child(3){transform:translateY(-13px) rotate(-45deg);}

/* SIDEBAR */
.sidebar {
  position:fixed;
  top:0;
  left:-260px;
  width:260px;
  height:100vh;
  background:rgba(10,10,20,0.95);
  backdrop-filter:blur(25px);
  border-right:1px solid rgba(255,255,255,0.25);
  padding:24px 18px;
  box-shadow:10px 0 40px rgba(0,0,0,0.7);
  transition:0.3s ease;
  z-index:9998;
}
.sidebar.open { left:0; }
.sidebar h2 {
  text-align:center;
  margin:0 0 18px;
  font-size:1.3rem;
  text-shadow:0 0 16px #fff;
}
.sidebar a {
  display:block;
  color:#fff;
  text-decoration:none;
  padding:9px 12px;
  margin-bottom:10px;
  border-radius:10px;
  background:rgba(255,255,255,0.08);
  box-shadow:0 0 10px rgba(255,255,255,0.15);
  font-size:0.9rem;
}
.sidebar a:hover {
  background:rgba(255,255,255,0.25);
  box-shadow:0 0 18px rgba(255,255,255,0.4);
}

/* FLOATING BUBBLES */
.bubble {
  position:fixed;
  width:150px;
  height:150px;
  border-radius:50%;
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(16px);
  box-shadow:0 0 40px rgba(255,255,255,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  text-decoration:none;
  font-size:0.9rem;
  text-align:center;
  padding:10px;
  z-index:5; /* behind main shell but clickable at edges */
  transition:transform 0.2s;
}
.bubble:hover {
  transform:scale(1.08);
}

/* MAIN WRAPPER */
.wrapper {
  max-width:1400px;
  margin:120px auto 80px;
  padding:20px;
}

/* CALENDAR SHELL */
.calendar-shell {
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(24px);
  border-radius:24px;
  box-shadow:0 0 60px rgba(255,255,255,0.3);
  padding:24px;
  position:relative;
  z-index:20;
}

/* HEADER */
.title {
  font-size:3.2rem;
  text-align:center;
  margin:0 0 6px;
  text-shadow:0 0 40px #fff;
}
.subtitle {
  text-align:center;
  opacity:0.85;
  margin:0 0 22px;
}

/* MONTH HEADER */
.month-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}
.month-name {
  font-size:1.6rem;
  font-weight:600;
}
.month-nav button {
  background:rgba(255,255,255,0.18);
  color:#fff;
  border:none;
  padding:7px 12px;
  border-radius:999px;
  cursor:pointer;
  margin-left:6px;
  font-size:0.9rem;
}
.month-nav button:hover {
  background:#fff;
  color:#000;
}

/* GIANT GRID */
.weekdays,
.calendar-grid {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.weekday {
  text-align:center;
  opacity:0.75;
  font-size:0.9rem;
}
.day-cell {
  min-height:120px;
  background:rgba(0,0,0,0.6);
  border-radius:14px;
  padding:8px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.12);
  position:relative;
  overflow:hidden;
}
.day-cell.other-month { opacity:0.35; }
.day-cell.today {
  border-color:rgba(255,255,255,0.9);
  box-shadow:0 0 18px rgba(255,255,255,0.9);
}
.day-cell.selected {
  border-color:#4fc3ff;
  box-shadow:0 0 18px rgba(79,195,255,0.9);
}
.day-number {
  font-weight:600;
  font-size:1rem;
}
.day-tags {
  margin-top:6px;
  font-size:0.75rem;
  line-height:1.2;
}
.day-tag-pill {
  display:inline-block;
  padding:2px 6px;
  margin:0 4px 4px 0;
  border-radius:999px;
  background:rgba(255,255,255,0.16);
  font-size:0.7rem;
}
.day-tag-pill.event { border:1px solid #4fff81; }
.day-tag-pill.lesson { border:1px solid #ffd54f; }
.day-tag-pill.spot { border:1px solid #4fc3ff; }
.day-tag-pill.custom { border:1px solid #ff4f81; }

/* DETAILS PANEL */
.details {
  margin-top:22px;
  background:rgba(0,0,0,0.75);
  border-radius:18px;
  padding:18px;
}
.details-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.details-date {
  font-size:1.2rem;
}
.add-btn {
  padding:7px 13px;
  border:none;
  border-radius:999px;
  background:#fff;
  color:#000;
  cursor:pointer;
  font-size:0.85rem;
}
.add-btn:hover {
  box-shadow:0 0 16px rgba(255,255,255,0.9);
}

/* LIST */
.item-list {
  margin-top:12px;
  max-height:260px;
  overflow-y:auto;
}
.item-empty {
  margin-top:4px;
  opacity:0.75;
  font-size:0.9rem;
}
.item {
  background:rgba(255,255,255,0.12);
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
  font-size:0.85rem;
  box-shadow:0 0 18px rgba(0,0,0,0.7);
}
.item-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:4px;
}
.item-type {
  font-size:0.75rem;
  opacity:0.8;
}
.item-privacy {
  font-size:0.7rem;
  padding:2px 7px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.5);
}
.item-body {
  line-height:1.4;
}
.item-actions {
  margin-top:6px;
}
.item-actions button {
  padding:4px 9px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-size:0.75rem;
  margin-right:6px;
}
.item-actions .edit-btn { background:#fff; color:#000; }
.item-actions .delete-btn { background:rgba(255,80,80,0.22); color:#ff9999; }

/* INLINE EDITOR */
.editor {
  margin-top:8px;
  padding:8px;
  border-radius:10px;
  background:rgba(0,0,0,0.6);
}
.editor-row {
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.editor input,
.editor select {
  flex:1 1 100%;
  background:rgba(255,255,255,0.16);
  border:none;
  border-radius:8px;
  padding:6px 8px;
  color:#fff;
  font-size:0.8rem;
}
.editor input::placeholder {
  color:rgba(255,255,255,0.6);
}
.editor-actions {
  margin-top:6px;
}
.editor-actions button {
  padding:5px 10px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-size:0.75rem;
  margin-right:6px;
}
.editor .save-btn { background:#fff; color:#000; }
.editor .cancel-btn { background:rgba(255,255,255,0.2); color:#fff; }
</style>
</head>

<body>

<div class="stars"></div>

<!-- BURGER -->
<div class="hamburger" id="hamburger">
  <span></span><span></span><span></span>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="profile.html">Profile</a>
  <a href="chatrooms.html">Chatrooms</a>
  <a href="find-spots.html">Find Spots</a>
  <a href="events.html">Events</a>
  <a href="calendar.html">Calendar</a>
</div>

<!-- FLOATING BUBBLES -->
<a href="chatrooms.html" class="bubble" id="bubbleChat">Chat</a>
<a href="profile.html" class="bubble" id="bubbleProfile">Profile</a>
<a href="find-spots.html" class="bubble" id="bubbleSpots">Spots</a>
<a href="dashboard.html" class="bubble" id="bubbleDash">Dashboard</a>

<!-- MAIN -->
<div class="wrapper">
  <div class="calendar-shell">
    <div class="title">My Calendar</div>
    <p class="subtitle">One giant, editable calendar. Click a day, add and edit your stuff.</p>

    <!-- MONTH HEADER -->
    <div class="month-header">
      <div class="month-name" id="monthName"></div>
      <div class="month-nav">
        <button id="prevMonthBtn">‚üµ Prev</button>
        <button id="nextMonthBtn">Next ‚ü∂</button>
      </div>
    </div>

    <!-- WEEKDAYS -->
    <div class="weekdays">
      <div class="weekday">Sun</div>
      <div class="weekday">Mon</div>
      <div class="weekday">Tue</div>
      <div class="weekday">Wed</div>
      <div class="weekday">Thu</div>
      <div class="weekday">Fri</div>
      <div class="weekday">Sat</div>
    </div>

    <!-- GIANT GRID -->
    <div class="calendar-grid" id="calendarGrid"></div>

    <!-- DAY DETAILS -->
    <div class="details">
      <div class="details-header">
        <div class="details-date" id="detailsDate">Select a day</div>
        <button class="add-btn" id="addItemBtn">+ Add Item</button>
      </div>
      <div class="item-list" id="itemList"></div>
      <div class="item-empty" id="itemEmpty">Nothing on this day yet.</div>
    </div>
  </div>
</div>

<script>
/* SIMPLE USER CONTEXT ‚Äì NO REDIRECT */
let user = null;
try {
  user = JSON.parse(localStorage.getItem("rc_user"));
} catch(e) {
  user = null;
}
if (!user) {
  user = { id: "guest_" + Date.now(), username: "Guest" };
}
const OWNER_ID = user.id || user.username || "anonymous";

/* BURGER TOGGLE */
document.getElementById("hamburger").onclick = () => {
  document.getElementById("hamburger").classList.toggle("active");
  document.getElementById("sidebar").classList.toggle("open");
};

/* FLOATING BUBBLES PONG ANIMATION */
const bubbleSize = 150;
const bubbles = [
  { el: document.getElementById("bubbleChat"), x:60, y:110, vx:1.4, vy:1.1 },
  { el: document.getElementById("bubbleProfile"), x:window.innerWidth-220, y:80, vx:-1.3, vy:1.4 },
  { el: document.getElementById("bubbleSpots"), x:80, y:window.innerHeight-250, vx:1.6, vy:-1.2 },
  { el: document.getElementById("bubbleDash"), x:window.innerWidth-220, y:window.innerHeight-250, vx:-1.5, vy:-1.3 }
];

function positionBubbles() {
  bubbles.forEach(b => {
    b.el.style.left = b.x + "px";
    b.el.style.top = b.y + "px";
  });
}
function animateBubbles() {
  const w = window.innerWidth;
  const h = window.innerHeight;

  bubbles.forEach(b => {
    b.x += b.vx;
    b.y += b.vy;

    if (b.x <= 0 || b.x + bubbleSize >= w) b.vx *= -1;
    if (b.y <= 0 || b.y + bubbleSize >= h) b.vy *= -1;

    // crude separation so they don't sit on top of each other
    bubbles.forEach(o => {
      if (o === b) return;
      const dx = (b.x + bubbleSize/2) - (o.x + bubbleSize/2);
      const dy = (b.y + bubbleSize/2) - (o.y + bubbleSize/2);
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < bubbleSize) {
        b.vx *= -1;
        b.vy *= -1;
      }
    });

    b.el.style.left = b.x + "px";
    b.el.style.top = b.y + "px";
  });

  requestAnimationFrame(animateBubbles);
}
positionBubbles();
requestAnimationFrame(animateBubbles);

/* CALENDAR STORAGE (LOCAL ONLY FOR NOW) */
function getCalendarItems() {
  try {
    return JSON.parse(localStorage.getItem("rc_calendar_items") || "[]");
  } catch(e) {
    return [];
  }
}
function saveCalendarItems(items) {
  localStorage.setItem("rc_calendar_items", JSON.stringify(items));
}

/* DATE HELPERS */
function toISODate(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
function fromISODate(iso) {
  const [y,m,d] = iso.split("-");
  return new Date(+y, +m-1, +d);
}
function prettyDate(iso) {
  const d = fromISODate(iso);
  return d.toLocaleDateString(undefined, { weekday:"long", month:"long", day:"numeric", year:"numeric" });
}

/* CALENDAR STATE */
let currentYear, currentMonth; // month: 0-11
let selectedDate = null;

/* RENDER MONTH GRID */
function renderMonth() {
  const monthNameEl = document.getElementById("monthName");
  const grid = document.getElementById("calendarGrid");
  grid.innerHTML = "";

  const firstOfMonth = new Date(currentYear, currentMonth, 1);
  const monthLabel = firstOfMonth.toLocaleString(undefined, { month:"long", year:"numeric" });
  monthNameEl.textContent = monthLabel;

  const firstDayIndex = firstOfMonth.getDay();
  const daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();
  const daysInPrev = new Date(currentYear, currentMonth, 0).getDate();
  const todayISO = toISODate(new Date());
  const allItems = getCalendarItems().filter(i => i.ownerId === OWNER_ID);

  // build cell descriptors
  const cells = [];
  for (let i=0; i<firstDayIndex; i++) {
    const day = daysInPrev - firstDayIndex + 1 + i;
    cells.push({ date: new Date(currentYear, currentMonth-1, day), other:true });
  }
  for (let d=1; d<=daysInMonth; d++) {
    cells.push({ date: new Date(currentYear, currentMonth, d), other:false });
  }
  while (cells.length % 7 !== 0) {
    const day = cells.length - firstDayIndex - daysInMonth + 1;
    cells.push({ date: new Date(currentYear, currentMonth+1, day), other:true });
  }

  cells.forEach(cell => {
    const iso = toISODate(cell.date);
    const cellItems = allItems.filter(i => i.date === iso);

    const div = document.createElement("div");
    div.className = "day-cell" + (cell.other ? " other-month" : "");
    if (iso === todayISO) div.classList.add("today");
    if (iso === selectedDate) div.classList.add("selected");
    div.dataset.date = iso;

    const num = document.createElement("div");
    num.className = "day-number";
    num.textContent = cell.date.getDate();
    div.appendChild(num);

    if (cellItems.length) {
      const tagsDiv = document.createElement("div");
      tagsDiv.className = "day-tags";

      const hasEvent = cellItems.some(i => i.type === "event");
      const hasLesson = cellItems.some(i => i.type === "lesson");
      const hasSpot = cellItems.some(i => i.type === "spot");
      const hasCustom = cellItems.some(i => i.type === "custom");

      if (hasEvent) {
        const t = document.createElement("span");
        t.className = "day-tag-pill event";
        t.textContent = "Event";
        tagsDiv.appendChild(t);
      }
      if (hasLesson) {
        const t = document.createElement("span");
        t.className = "day-tag-pill lesson";
        t.textContent = "Lesson";
        tagsDiv.appendChild(t);
      }
      if (hasSpot) {
        const t = document.createElement("span");
        t.className = "day-tag-pill spot";
        t.textContent = "Spot";
        tagsDiv.appendChild(t);
      }
      if (hasCustom) {
        const t = document.createElement("span");
        t.className = "day-tag-pill custom";
        t.textContent = "Custom";
        tagsDiv.appendChild(t);
      }
      div.appendChild(tagsDiv);
    }

    div.onclick = () => {
      selectedDate = iso;
      renderMonth();
      renderDayDetails();
    };

    grid.appendChild(div);
  });
}

/* RENDER DAY DETAILS */
function renderDayDetails() {
  const dateLabel = document.getElementById("detailsDate");
  const listEl = document.getElementById("itemList");
  const emptyEl = document.getElementById("itemEmpty");

  if (!selectedDate) {
    emptyEl.style.display = "block";
    dateLabel.textContent = "Select a day";
    listEl.innerHTML = "";
    return;
  }

  dateLabel.textContent = prettyDate(selectedDate);

  const allItems = getCalendarItems().filter(i => i.ownerId === OWNER_ID && i.date === selectedDate);
  listEl.innerHTML = "";

  if (!allItems.length) {
    emptyEl.style.display = "block";
    return;
  }
  emptyEl.style.display = "none";

  allItems.forEach(item => {
    const card = document.createElement("div");
    card.className = "item";
    card.dataset.id = item.id;

    const typeLabel =
      item.type === "event" ? "üìÖ Event" :
      item.type === "lesson" ? "üéì Lesson" :
      item.type === "spot" ? "üìç Spot" :
      "‚≠ê Custom";

    const privacyLabel =
      item.privacy === "public" ? "üåê Public" :
      item.privacy === "private" ? "üîí Private" :
      item.privacy === "groups" ? "üë• Groups" :
      "üåê Public";

    const groupsText =
      item.privacy === "groups" && item.groups && item.groups.length
        ? `<br>Groups: ${item.groups.join(", ")}`
        : "";

    card.innerHTML = `
      <div class="item-header">
        <div>
          <strong>${item.title || "Untitled"}</strong>
          <div class="item-type">${typeLabel}</div>
        </div>
        <div class="item-privacy">${privacyLabel}</div>
      </div>
      <div class="item-body">
        ${item.time ? `‚è∞ ${item.time}<br>` : ""}
        ${item.location ? `üìç ${item.location}<br>` : ""}
        ${item.link ? `<a href="${item.link}">Open</a><br>` : ""}
        ${groupsText}
      </div>
      <div class="item-actions">
        <button class="edit-btn">Edit</button>
        <button class="delete-btn">Delete</button>
      </div>
    `;

    listEl.appendChild(card);
  });
}

/* ADD CUSTOM ITEM */
function addItemForSelectedDay() {
  if (!selectedDate) {
    selectedDate = toISODate(new Date());
  }
  const items = getCalendarItems();
  const id = "cal_" + Date.now() + "_" + Math.random().toString(16).slice(2);

  items.push({
    id,
    ownerId: OWNER_ID,
    type: "custom",      // default, can change in editor later
    refId: null,
    title: "New item",
    date: selectedDate,
    time: "",
    location: "",
    link: "",
    privacy: "private",
    groups: []
  });

  saveCalendarItems(items);
  renderMonth();
  renderDayDetails();
  openEditor(id);
}

/* INLINE EDITOR */
function openEditor(id) {
  const items = getCalendarItems();
  const item = items.find(i => i.id === id && i.ownerId === OWNER_ID);
  if (!item) return;

  const listEl = document.getElementById("itemList");
  const card = listEl.querySelector(`.item[data-id="${id}"]`);
  if (!card) return;

  const existing = card.querySelector(".editor");
  if (existing) existing.remove();

  const ed = document.createElement("div");
  ed.className = "editor";
  const groupsStr = (item.groups || []).join(", ");

  ed.innerHTML = `
    <div class="editor-row">
      <input data-field="title" placeholder="Title" value="${item.title || ""}">
      <input data-field="time" placeholder="Time (e.g. 7:00 PM)" value="${item.time || ""}">
      <input data-field="location" placeholder="Location" value="${item.location || ""}">
    </div>
    <div class="editor-row" style="margin-top:4px;">
      <select data-field="type">
        <option value="event" ${item.type === "event" ? "selected" : ""}>Event</option>
        <option value="lesson" ${item.type === "lesson" ? "selected" : ""}>Lesson</option>
        <option value="spot" ${item.type === "spot" ? "selected" : ""}>Spot</option>
        <option value="custom" ${item.type === "custom" ? "selected" : ""}>Custom</option>
      </select>
      <select data-field="privacy">
        <option value="public" ${item.privacy === "public" ? "selected" : ""}>Public</option>
        <option value="private" ${item.privacy === "private" ? "selected" : ""}>Private</option>
        <option value="groups" ${item.privacy === "groups" ? "selected" : ""}>Groups</option>
      </select>
    </div>
    <div class="editor-row" style="margin-top:4px;">
      <input data-field="groups" placeholder="Groups (comma separated)" value="${groupsStr}">
      <input data-field="link" placeholder="Link (optional)" value="${item.link || ""}">
    </div>
    <div class="editor-actions">
      <button class="save-btn">Save</button>
      <button class="cancel-btn">Cancel</button>
    </div>
  `;

  card.appendChild(ed);

  ed.querySelector(".save-btn").onclick = () => {
    ed.querySelectorAll("[data-field]").forEach(el => {
      const field = el.dataset.field;
      const val = el.value.trim();
      if (field === "groups") {
        item.groups = val ? val.split(",").map(v => v.trim()).filter(Boolean) : [];
      } else {
        item[field] = val || "";
      }
    });
    saveCalendarItems(items);
    renderDayDetails();
    renderMonth();
  };
  ed.querySelector(".cancel-btn").onclick = () => ed.remove();
}

/* DELETE ITEM */
function deleteItem(id) {
  let items = getCalendarItems();
  items = items.filter(i => !(i.id === id && i.ownerId === OWNER_ID));
  saveCalendarItems(items);
  renderDayDetails();
  renderMonth();
}

/* LIST CLICK HANDLERS */
document.getElementById("itemList").addEventListener("click", e => {
  const card = e.target.closest(".item");
  if (!card) return;
  const id = card.dataset.id;
  if (e.target.classList.contains("edit-btn")) {
    openEditor(id);
  } else if (e.target.classList.contains("delete-btn")) {
    deleteItem(id);
  }
});

/* ADD BUTTON */
document.getElementById("addItemBtn").onclick = addItemForSelectedDay;

/* MONTH NAV */
document.getElementById("prevMonthBtn").onclick = () => {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  }
  renderMonth();
  renderDayDetails();
};
document.getElementById("nextMonthBtn").onclick = () => {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderMonth();
  renderDayDetails();
};

/* INIT */
(function init() {
  const now = new Date();
  currentYear = now.getFullYear();
  currentMonth = now.getMonth();
  selectedDate = toISODate(now);

  renderMonth();
  renderDayDetails();
})();
</script>

</body>
</html>
