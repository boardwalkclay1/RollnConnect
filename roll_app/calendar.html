<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Calendar ‚Äì Roll ‚Äôn Connect</title>

<style>
/* GLOBAL */
body {
  background:#000;
  color:#fff;
  margin:0;
  padding:0;
  font-family:'Inter',sans-serif;
  overflow-x:hidden;
  min-height:100vh;
}

/* STARFIELDS */
.stars1,.stars2,.stars3 {
  position:fixed; inset:0;
  background:url('styles/stars-white.png') repeat;
  z-index:-3;
  pointer-events:none;
}
.stars1{opacity:.55;animation:drift1 140s linear infinite;}
.stars2{opacity:.35;animation:drift2 200s linear infinite;}
.stars3{opacity:.2; animation:drift3 260s linear infinite;}

@keyframes drift1{from{background-position:0 0;}to{background-position:0 -5000px;}}
@keyframes drift2{from{background-position:0 0;}to{background-position:-4000px -2000px;}}
@keyframes drift3{from{background-position:0 0;}to{background-position:3000px 4000px;}}

/* BURGER */
.hamburger {
  position:fixed;
  top:25px;
  left:25px;
  width:40px;
  height:30px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
  z-index:99999;
}
.hamburger span {
  height:4px;
  width:100%;
  background:#fff;
  border-radius:4px;
  box-shadow:0 0 12px rgba(255,255,255,0.9);
  transition:0.3s;
}
.hamburger.active span:nth-child(1){transform:translateY(13px) rotate(45deg);}
.hamburger.active span:nth-child(2){opacity:0;}
.hamburger.active span:nth-child(3){transform:translateY(-13px) rotate(-45deg);}

/* SIDEBAR */
.sidebar {
  position:fixed;
  top:0;
  left:-260px;
  width:260px;
  height:100vh;
  background:rgba(10,10,20,0.92);
  backdrop-filter:blur(25px);
  border-right:1px solid rgba(255,255,255,0.25);
  padding:26px 20px;
  box-shadow:10px 0 40px rgba(0,0,0,0.7);
  transition:0.35s ease;
  z-index:99998;
}
.sidebar.open { left:0; }

.sidebar-header {
  text-align:center;
  margin-bottom:24px;
}
.sidebar-header h2 {
  font-size:1.4rem;
  text-shadow:0 0 20px #fff;
}

.sidebar a {
  display:block;
  color:#fff;
  text-decoration:none;
  padding:10px 14px;
  margin-bottom:10px;
  border-radius:10px;
  background:rgba(255,255,255,0.05);
  box-shadow:0 0 10px rgba(255,255,255,0.15);
  transition:0.25s;
}
.sidebar a:hover {
  background:rgba(255,255,255,0.2);
  transform:translateX(5px);
  box-shadow:0 0 18px rgba(255,255,255,0.4);
}

/* MAIN WRAPPER */
.cosmic-wrapper {
  padding:140px 20px 80px;
  max-width:900px;
  margin:0 auto;
}

/* GLASS PANEL */
.glass {
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(20px);
  padding:30px;
  border-radius:20px;
  box-shadow:0 0 40px rgba(255,255,255,0.25);
  margin-bottom:40px;
}

.section-title {
  font-size:3rem;
  text-align:center;
  text-shadow:0 0 40px #fff;
}

/* CALENDAR LIST */
.calendar-list {
  list-style:none;
  padding:0;
  margin:0;
}

.calendar-item {
  padding:18px;
  margin-bottom:16px;
  border-radius:14px;
  background:rgba(255,255,255,0.12);
  box-shadow:0 0 30px rgba(255,255,255,0.25);
}

.calendar-item a {
  color:#fff;
  text-decoration:underline;
}

/* EDITOR */
.editor {
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:rgba(255,255,255,0.08);
}
.editor input,
.editor select {
  width:100%;
  margin-bottom:10px;
  padding:8px;
  border-radius:8px;
  border:none;
  background:rgba(255,255,255,0.15);
  color:#fff;
}
.editor button {
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  margin-right:8px;
}
.editor .save-btn { background:#fff; color:#000; }
.editor .cancel-btn { background:rgba(255,255,255,0.2); color:#fff; }

.item-actions {
  margin-top:10px;
}
.item-actions button {
  padding:6px 12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  margin-right:8px;
}
.item-actions .edit-btn { background:#fff; color:#000; }
.item-actions .delete-btn { background:rgba(255,80,80,0.2); color:#ff8080; }
</style>
</head>

<body>

<!-- STARFIELDS -->
<div class="stars1"></div>
<div class="stars2"></div>
<div class="stars3"></div>

<!-- BURGER -->
<div id="hamburger" class="hamburger">
  <span></span><span></span><span></span>
</div>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="sidebar-header"><h2>Menu</h2></div>
  <a href="dashboard.html">Dashboard</a>
  <a href="profile.html">My Profile</a>
  <a href="profile-edit.html">Edit Profile</a>
  <a href="chatrooms.html">Chatrooms</a>
  <a href="events.html">Events</a>
  <a href="find-spots.html">Find Spots</a>
  <a href="calendar.html">My Calendar</a>
</div>

<!-- MAIN CONTENT -->
<div class="cosmic-wrapper">

  <div class="glass">
    <h1 class="section-title">My Calendar</h1>
  </div>

  <div class="glass">
    <ul id="calendarFullList" class="calendar-list"></ul>
    <p id="calendarEmpty" style="display:none; opacity:0.7;">Nothing saved yet.</p>
  </div>

</div>

<script>
/* AUTH CHECK */
const user = JSON.parse(localStorage.getItem("rc_user"));
if (!user) window.location.href = "index.html";

/* BURGER */
document.getElementById("hamburger").onclick = () => {
  document.getElementById("hamburger").classList.toggle("active");
  document.getElementById("sidebar").classList.toggle("open");
};

/* CALENDAR STORAGE */
function getCalendar() {
  return JSON.parse(localStorage.getItem("rc_calendar_items") || "[]");
}
function saveCalendar(items) {
  localStorage.setItem("rc_calendar_items", JSON.stringify(items));
}

/* SEED FROM EVENTS + SPOTS */
function seedCalendar() {
  const items = getCalendar();
  const events = JSON.parse(localStorage.getItem("rc_events") || "[]");
  const spots = JSON.parse(localStorage.getItem("rc_spots") || "[]");
  const savedEvents = JSON.parse(localStorage.getItem("rc_user_saved_events") || "[]");
  const savedSpots = JSON.parse(localStorage.getItem("rc_user_saved_spots") || "[]");

  const owner = user.id || user.username;

  events.forEach(ev => {
    if (!savedEvents.includes(ev.id)) return;
    if (items.some(i => i.refId === ev.id)) return;

    items.push({
      id: "cal_" + crypto.randomUUID(),
      type: "event",
      refId: ev.id,
      title: ev.title,
      date: ev.date,
      location: ev.location,
      distance: null,
      link: `event-details.html?id=${ev.id}`,
      privacy: "public",
      groups: [],
      ownerId: owner
    });
  });

  spots.forEach(sp => {
    if (!savedSpots.includes(sp.id)) return;
    if (items.some(i => i.refId === sp.id)) return;

    items.push({
      id: "cal_" + crypto.randomUUID(),
      type: "spot",
      refId: sp.id,
      title: sp.name,
      date: null,
      location: sp.location,
      distance: sp.distance,
      link: `spot-details.html?id=${sp.id}`,
      privacy: "public",
      groups: [],
      ownerId: owner
    });
  });

  saveCalendar(items);
}

/* RENDER */
function renderCalendar() {
  const list = document.getElementById("calendarFullList");
  const empty = document.getElementById("calendarEmpty");
  list.innerHTML = "";

  const owner = user.id || user.username;
  const items = getCalendar().filter(i => i.ownerId === owner);

  if (!items.length) {
    empty.style.display = "block";
    return;
  }
  empty.style.display = "none";

  items.forEach(item => {
    const li = document.createElement("li");
    li.className = "calendar-item";
    li.dataset.id = item.id;

    const privacyLabel =
      item.privacy === "public" ? "üåê Public" :
      item.privacy === "private" ? "üîí Private" :
      "üë• Groups";

    const groupsText =
      item.privacy === "groups" && item.groups.length
        ? `<br>Groups: ${item.groups.join(", ")}`
        : "";

    li.innerHTML = `
      <strong>${item.title}</strong><br>
      ${item.date ? `üìÖ ${item.date}<br>` : ""}
      ${item.location ? `üìç ${item.location}<br>` : ""}
      ${item.distance ? `üõº ${item.distance} miles away<br>` : ""}
      ${item.link ? `<a href="${item.link}">View Details</a><br>` : ""}
      ${privacyLabel}${groupsText}
      <div class="item-actions">
        <button class="edit-btn">Edit</button>
        <button class="delete-btn">Delete</button>
      </div>
    `;

    list.appendChild(li);
  });
}

/* EDITOR */
function openEditor(id) {
  const items = getCalendar();
  const item = items.find(i => i.id === id);
  if (!item) return;

  const li = document.querySelector(`[data-id="${id}"]`);
  if (!li) return;

  const editor = document.createElement("div");
  editor.className = "editor";

  editor.innerHTML = `
    <input data-field="title" value="${item.title}">
    <input data-field="date" type="date" value="${item.date || ""}">
    <input data-field="location" placeholder="Location" value="${item.location || ""}">
    <input data-field="distance" placeholder="Distance" value="${item.distance || ""}">
    <select data-field="privacy">
      <option value="public" ${item.privacy === "public" ? "selected" : ""}>Public</option>
      <option value="private" ${item.privacy === "private" ? "selected" : ""}>Private</option>
      <option value="groups" ${item.privacy === "groups" ? "selected" : ""}>Groups</option>
    </select>
    <input data-field="groups" placeholder="Groups (comma separated)" value="${item.groups.join(", ")}">
    <button class="save-btn">Save</button>
    <button class="cancel-btn">Cancel</button>
  `;

  li.appendChild(editor);

  editor.querySelector(".save-btn").onclick = () => {
    editor.querySelectorAll("[data-field]").forEach(el => {
      const field = el.dataset.field;
      if (field === "groups") {
        item.groups = el.value.split(",").map(g => g.trim()).filter(Boolean);
      } else {
        item[field] = el.value || null;
      }
    });
    saveCalendar(items);
    renderCalendar();
  };

  editor.querySelector(".cancel-btn").onclick = () => editor.remove();
}

/* DELETE */
function deleteItem(id) {
  const items = getCalendar().filter(i => i.id !== id);
  saveCalendar(items);
  renderCalendar();
}

/* CLICK HANDLERS */
document.getElementById("calendarFullList").onclick = e => {
  const li = e.target.closest(".calendar-item");
  if (!li) return;

  const id = li.dataset.id;

  if (e.target.classList.contains("edit-btn")) {
    openEditor(id);
  }
  if (e.target.classList.contains("delete-btn")) {
    deleteItem(id);
  }
};

/* INIT */
seedCalendar();
renderCalendar();
</script>

</body>
</html>
