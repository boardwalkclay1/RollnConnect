<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{CITYNAME}} – {{DISCIPLINENAME}} Chatroom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="rollnconnect.css" />
</head>
<body>
<div class="app-shell">

<header class="app-header">
  <div class="app-header-left">
    <div class="brand-logo">R</div>
    <div class="brand-name">{{CITYNAME}} – {{DISCIPLINENAME}}</div>
  </div>
  <div class="app-header-right">
    <a href="chat-city-{{CITY}}.html" class="icon-btn">←</a>
  </div>
</header>

<main class="page">
  <h1>{{DISCIPLINENAME}} – {{CITYNAME}}</h1>
  <p class="section-sub">
    Welcome to the {{DISCIPLINENAME}} room for {{CITYNAME}}.  
    Up to 200 riders can chat here at once. Oldest messages auto‑delete after 500.
  </p>

  <div class="card">
    <div class="chat-window">
      <div id="chatMessages" class="chat-messages"></div>

      <form class="chat-input-row" onsubmit="sendMessage(event)">
        <input id="chatInput" type="text" placeholder="Say something..." required />
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </div>
  </div>
</main>

<footer>
  <div class="footer-row">
    <span>© <span id="year"></span> Roll ’n Connect.</span>
  </div>
</footer>

</div>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

const roomKey = "chatroom_{{CITY}}_{{DISCIPLINE}}";
let messages = JSON.parse(localStorage.getItem(roomKey) || "[]");

function saveMessages() {
  if (messages.length > 500) messages = messages.slice(-500);
  localStorage.setItem(roomKey, JSON.stringify(messages));
}

function renderMessages() {
  const container = document.getElementById("chatMessages");
  container.innerHTML = "";
  messages.forEach(msg => {
    const div = document.createElement("div");
    div.className = "chat-message" + (msg.sender === "@You" ? " self" : "");
    div.innerHTML = `
      <div class="chat-avatar"></div>
      <div class="chat-bubble">
        <div class="chat-sender">${msg.sender}</div>
        <div class="chat-text">${msg.text}</div>
      </div>
    `;
    container.appendChild(div);
  });
  container.scrollTop = container.scrollHeight;
}

function sendMessage(e) {
  e.preventDefault();
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;
  messages.push({ sender: "@You", text });
  saveMessages();
  renderMessages();
  input.value = "";
}

renderMessages();
</script>
</body>
</html>
