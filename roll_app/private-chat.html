<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DM â€“ Roll â€™n Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="rollnconnect.css" />
</head>
<body>
<div class="app-shell">

  <header class="app-header">
    <div class="app-header-left">
      <div class="brand-logo">R</div>
      <div class="brand-name">Roll â€™n Connect</div>
    </div>
    <div class="app-header-right">
      <a href="chat.html" class="icon-btn">â†</a>
    </div>
  </header>

  <main class="page">
    <h1 id="dmTitle">Direct Message</h1>

    <div class="card">
      <div class="chat-window">
        <div id="dmMessages" class="chat-messages"></div>

        <form class="chat-input-row" onsubmit="sendDM(event)">
          <input id="dmInput" type="text" placeholder="Send a message..." required />
          <button type="submit" class="btn btn-primary" style="padding:0 14px;">Send</button>
        </form>
      </div>
      <p style="margin-top:8px; font-size:11px; color:var(--text-soft);">
        This DM UI keeps the last 500 messages for this conversation in local storage as a simulation.
      </p>
    </div>
  </main>

  <footer>
    <div class="footer-row">
      <span>Â© <span id="year"></span> Roll â€™n Connect.</span>
    </div>
  </footer>

  <nav class="bottom-nav">
    <a href="index.html" class="bottom-nav-link">
      <div class="bottom-nav-icon">ğŸ </div>
      <span>Home</span>
    </a>
    <a href="spots-map.html" class="bottom-nav-link">
      <div class="bottom-nav-icon">ğŸ§­</div>
      <span>Explore</span>
    </a>
    <a href="clips-feed.html" class="bottom-nav-link">
      <div class="bottom-nav-icon">â–¶</div>
      <span>Clips</span>
    </a>
    <a href="marketplace.html" class="bottom-nav-link">
      <div class="bottom-nav-icon">ğŸ›’</div>
      <span>Market</span>
    </a>
    <a href="chat.html" class="bottom-nav-link bottom-nav-link-active">
      <div class="bottom-nav-icon">ğŸ’¬</div>
      <span>Chat</span>
    </a>
  </nav>
</div>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const dmUser = localStorage.getItem("rc_current_dm") || "@Skater";
  document.getElementById("dmTitle").textContent = "Chat with " + dmUser;

  const currentUser = "@You";
  const STORAGE_KEY = "rc_dm_" + dmUser;
  let messages = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  function saveMessages() {
    if (messages.length > 500) messages = messages.slice(messages.length - 500);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
  }

  function renderMessages() {
    const container = document.getElementById("dmMessages");
    container.innerHTML = "";

    messages.forEach(msg => {
      const div = document.createElement("div");
      div.className = "chat-message" + (msg.sender === currentUser ? " self" : "");
      div.innerHTML = `
        <div class="chat-avatar"></div>
        <div class="chat-bubble">
          <div class="chat-sender">${msg.sender}</div>
          <div class="chat-text">${msg.text}</div>
        </div>
      `;
      container.appendChild(div);
    });

    container.scrollTop = container.scrollHeight;
  }

  function sendDM(e) {
    e.preventDefault();
    const input = document.getElementById("dmInput");
    const text = input.value.trim();
    if (!text) return;

    messages.push({ sender: currentUser, text, ts: Date.now() });
    saveMessages();
    renderMessages();
    input.value = "";
  }

  renderMessages();
</script>
</body>
</html>
