<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Atlanta ‚Ä¢ Longboard Chat ‚Äì Roll ‚Äôn Connect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="rollnconnect.css" />
  <style>
    body.light-theme {
      --bg: #f7f7fb;
      --bg-elevated: #ffffff;
      --text: #111827;
      --muted: #6b7280;
    }
    body.dark-theme {
      --bg: #050509;
      --bg-elevated: #0b0b11;
      --text: #f9fafb;
      --muted: #9ca3af;
    }
    body {
      background: var(--bg);
      color: var(--text);
      transition: background 0.2s, color 0.2s;
    }
    .chat-shell {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 12px 16px;
      gap: 8px;
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      border-radius: 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-soft);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .msg-row { display: flex; flex-direction: column; max-width: 80%; }
    .msg-row.me { margin-left: auto; align-items: flex-end; }
    .msg-meta { font-size: 11px; color: var(--muted); margin-bottom: 2px; }
    .msg-bubble {
      border-radius: 14px;
      padding: 6px 9px;
      font-size: 13px;
      line-height: 1.4;
      border: 1px solid var(--border-soft);
      background: rgba(255,255,255,0.03);
    }
    .msg-row.me .msg-bubble {
      background: rgba(168,85,247,0.15);
      border-color: var(--purple);
    }
    .msg-bubble.system {
      background: rgba(59,130,246,0.08);
      border-color: #3b82f6;
      font-size: 12px;
    }
    .chat-input-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }
    .emoji-bar { display: flex; gap: 6px; font-size: 18px; }
    .emoji-btn, .quick-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      padding: 4px 8px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .quick-row { display: flex; gap: 6px; flex-wrap: wrap; }
    .input-row { display: flex; gap: 6px; }
    .input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 7px 10px;
      background: var(--bg-elevated);
      color: var(--text);
      font-size: 14px;
    }
    .send-btn {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      background: var(--purple);
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .theme-toggle {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      font-size: 11px;
      padding: 4px 8px;
      cursor: pointer;
      background: rgba(255,255,255,0.03);
      color: var(--muted);
    }
    .notif-bubble {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: var(--bg-elevated);
      border: 1px solid var(--purple);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 14px rgba(168,85,247,0.3);
      z-index: 50;
    }
    .notif-count {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 16px;
      height: 16px;
      border-radius: 999px;
      background: #ef4444;
      color: #fff;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 3px;
    }
    .notif-panel {
      position: fixed;
      right: 16px;
      bottom: 64px;
      width: 260px;
      max-height: 260px;
      overflow-y: auto;
      border-radius: 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-soft);
      padding: 8px;
      font-size: 12px;
      display: none;
      z-index: 49;
    }
    .notif-item {
      padding: 6px 4px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .notif-item:last-child { border-bottom: none; }
    .private-group-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
      background: transparent;
      color: var(--muted);
      margin-left: 8px;
    }
  </style>
</head>
<body class="dark-theme">
<div class="chat-shell">

  <header class="app-header">
    <div class="app-header-left">
      <div class="brand-logo">R</div>
      <div class="brand-name">Atlanta ‚Ä¢ Longboard</div>
    </div>
    <div class="app-header-right">
      <button id="theme-toggle" class="theme-toggle">Dark</button>
      <button class="icon-btn" onclick="location.href='profile.html'">üë§</button>
      <button class="private-group-btn" id="create-group-btn">+ Private group</button>
      <a href="chat-city-atlanta.html" class="icon-btn">‚Üê</a>
    </div>
  </header>

  <main class="chat-main">
    <div id="messages" class="messages"></div>

    <div class="chat-input-row">
      <div class="emoji-bar">
        <button class="emoji-btn" data-emoji="üòÄ">üòÄ</button>
        <button class="emoji-btn" data-emoji="üõπ">üõπ</button>
        <button class="emoji-btn" data-emoji="üî•">üî•</button>
        <button class="emoji-btn" data-emoji="‚ú®">‚ú®</button>
        <button class="emoji-btn" data-emoji="üíú">üíú</button>
      </div>

      <div class="quick-row">
        <button class="quick-btn" data-type="invite">üì® Invite</button>
        <button class="quick-btn" data-type="hug">ü§ó Hug</button>
        <button class="quick-btn" data-type="kiss">üíã Kiss</button>
      </div>

      <div class="input-row">
        <input id="msg-input" type="text" placeholder="Send a message..." />
        <button id="send-btn" class="send-btn">Send</button>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-row">
      <span>¬© <span id="year"></span> Roll ‚Äôn Connect.</span>
    </div>
  </footer>
</div>

<div id="notif-panel" class="notif-panel"></div>
<div id="notif-bubble" class="notif-bubble">
  üîî
  <div id="notif-count" class="notif-count" style="display:none;">0</div>
</div>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const CITY = "atlanta";
  const DISCIPLINE = "longboard";
  const roomKey = `chat_${CITY}_${DISCIPLINE}`;
  const notifsKey = "notifications";
  const username = localStorage.getItem("username") || "Skater";

  function getJSON(key, fallback) {
    const raw = localStorage.getItem(key);
    if (!raw) return fallback;
    try { return JSON.parse(raw); } catch { return fallback; }
  }
  function setJSON(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

  const themeToggle = document.getElementById("theme-toggle");
  const savedTheme = localStorage.getItem("chat_theme") || "dark";
  setTheme(savedTheme);

  function setTheme(mode) {
    document.body.classList.remove("light-theme", "dark-theme");
    document.body.classList.add(mode + "-theme");
    themeToggle.textContent = mode === "dark" ? "Dark" : "Light";
    localStorage.setItem("chat_theme", mode);
  }
  themeToggle.addEventListener("click", () => {
    const current = localStorage.getItem("chat_theme") || "dark";
    const next = current === "dark" ? "light" : "dark";
    setTheme(next);
  });

  const messagesEl = document.getElementById("messages");
  let messages = getJSON(roomKey, []);

  function renderMessages() {
    messagesEl.innerHTML = "";
    messages.forEach(m => {
      const row = document.createElement("div");
      row.className = "msg-row" + (m.user === username ? " me" : "");
      const meta = document.createElement("div");
      meta.className = "msg-meta";
      meta.textContent = (m.type === "system" ? "" : m.user + " ¬∑ ") + m.time;
      const bubble = document.createElement("div");
      bubble.className = "msg-bubble" + (m.type === "system" ? " system" : "");
      bubble.textContent = m.text;
      row.appendChild(meta);
      row.appendChild(bubble);
      messagesEl.appendChild(row);
    });
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  renderMessages();

  function nowTime() {
    const d = new Date();
    return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }

  function addMessage(text, type="user") {
    if (!text.trim()) return;
    const msg = { user: username, text, time: nowTime(), type };
    messages.push(msg);
    setJSON(roomKey, messages);
    renderMessages();
    addNotificationForMessage(msg);
  }

  const input = document.getElementById("msg-input");
  const sendBtn = document.getElementById("send-btn");

  sendBtn.addEventListener("click", () => {
    addMessage(input.value, "user");
    input.value = "";
  });
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      addMessage(input.value, "user");
      input.value = "";
    }
  });

  document.querySelectorAll(".emoji-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const emoji = btn.dataset.emoji;
      input.value += emoji;
      input.focus();
    });
  });

  document.querySelectorAll(".quick-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const type = btn.dataset.type;
      let text = "";
      if (type === "invite") text = `${username} sent an invite to skate üì®`;
      if (type === "hug")    text = `${username} sends a big skate hug ü§ó`;
      if (type === "kiss")   text = `${username} blows a kiss üíã`;
      addMessage(text, "system");
    });
  });

  const createGroupBtn = document.getElementById("create-group-btn");
  createGroupBtn.addEventListener("click", () => {
    const name = prompt("Name your private group:");
    if (!name) return;
    const groups = getJSON("private_groups", []);
    groups.push({ name, createdBy: username, createdAt: new Date().toISOString() });
    setJSON("private_groups", groups);
    addNotification(`Private group ‚Äú${name}‚Äù created.`);
    alert("Private group created (MVP). Later this becomes a real private room.");
  });

  const notifBubble = document.getElementById("notif-bubble");
  const notifPanel = document.getElementById("notif-panel");
  const notifCountEl = document.getElementById("notif-count");

  function getNotifs() { return getJSON(notifsKey, []); }
  function setNotifs(list) { setJSON(notifsKey, list); updateNotifUI(); }

  function addNotification(text) {
    const list = getNotifs();
    list.unshift({ text, time: nowTime(), room: `${CITY} ‚Ä¢ ${DISCIPLINE}` });
    setNotifs(list.slice(0, 50));
  }

  function addNotificationForMessage(msg) {
    if (msg.type === "system" && msg.user === username) addNotification(msg.text);
  }

  function updateNotifUI() {
    const list = getNotifs();
    const count = list.length;
    if (count > 0) {
      notifCountEl.style.display = "flex";
      notifCountEl.textContent = count > 9 ? "9+" : count;
    } else {
      notifCountEl.style.display = "none";
    }
    notifPanel.innerHTML = list.length
      ? list.map(n => `
          <div class="notif-item">
            <strong>${n.room}</strong><br/>
            ${n.text}<br/>
            <span style="color:var(--muted);">${n.time}</span>
          </div>
        `).join("")
      : "<div class='notif-item'>No notifications yet.</div>";
  }
  updateNotifUI();

  let panelOpen = false;
  notifBubble.addEventListener("click", () => {
    panelOpen = !panelOpen;
    notifPanel.style.display = panelOpen ? "block" : "none";
    if (panelOpen) notifCountEl.style.display = "none";
  });
</script>
</body>
</html>
